---
title: "Maryland Sports Venues Data Exploration"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(sf)
library(janitor)
library(broom)
library(ggplot2)
library(gt)
library(leaflet)
```


```{r}
bball <- st_read("basketball/SOCI_Basketball_MDSports.shp")

golf <- st_read("golf/SOCI_Golf_MDSports.shp")

skateboarding <- st_read("skateboarding/SOCI_Skateboarding_MDSports.shp")

soccer <- st_read("soccer/SOCI_Soccer_MDSports.shp")

swimming <- st_read("swimming/SOCI_Swimming_MDSports.shp")

library(tidycensus)
census_api_key("0f4adff4206717d4947de6eb32d22e0b484ae6b8", install = TRUE, overwrite = TRUE)

#I used this to explore variables of interest.
vars <- load_variables(2010, "acs5", cache = TRUE)

#To get the ball rolling, I added in median household income, total population, white population and Black or African American population. I can calculate some percenatges with these figures. I'm definitely interested in incorporating more variables, but this is just a starting point.





leaflet() %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addCircleMarkers(
    data=bball,
    color="orange",
    radius=2,
    group="Basketball")%>%
  addCircleMarkers(
    data=golf,
    color="green",
    radius=2,
    group="Golf")%>%
  addCircleMarkers(
    data=skateboarding,
    color="purple",
    radius=2,
    group="Skateboarding")%>%
  addCircleMarkers(
    data=soccer,
    color="black",
    radius=2,
    group="Soccer")%>%
  addCircleMarkers(
    data=swimming,
    color="blue",
    radius=2,
    group="Swimming")%>%
  addLayersControl(
    overlayGroups = c("Golf", "Basketball", "Soccer", "Swimming", "Skateboarding"),
    options = layersControlOptions(collapsed = FALSE)
  )
  
```
 
 
```{r}
md_income <- get_acs(geography = "county", 
                     variables = "B19013_001", 
                     state = "MD",
                     geometry = TRUE)


pal <- colorQuantile(palette = "YlOrRd", domain = md_income$estimate, n = 10)

md_income%>% 
  st_transform(crs = "+init=epsg:4326") %>%
    leaflet(width = "100%") %>%
  addPolygons(
    popup = ~ str_extract(NAME, "^([^,]*)"),
     stroke = FALSE,
      smoothFactor = 0,
      fillOpacity = 0.7,
      color = ~ pal(estimate)) %>%
  addCircleMarkers(
    data=swimming,
    color="blue",
    radius=2,
    group="Swimming")%>%
   addLayersControl(
    overlayGroups = c("Swimming"),
    options = layersControlOptions(collapsed = FALSE)
  )%>%
  
  addLegend("bottomleft", 
        pal = pal, 
        values = ~ estimate,
        title = "Income Levels",
        opacity = 0.6)
  
```



```{r}

md_income <- get_acs(geography = "county", 
                     variables = "B19013_001", 
                     state = "MD",
                     geometry = TRUE)


md_income_tract <- get_acs(geography = "tract", 
                     variables = "B19013_001", 
                     state = "MD",
                     geometry = TRUE)

md_pop <- get_acs(geography = "county", 
                     variables = "B01003_001", 
                     state = "MD",
                     geometry = TRUE)

md <- get_acs(geography = "county", 
                     state = "MD",
                     geometry = TRUE)

md_black_pop <- get_acs(geography = "county", 
                     variables = "B02001_003", 
                     state = "MD",
                     geometry = TRUE)


md_white_pop <- get_acs(geography = "county", 
                     variables = "B02001_002", 
                     state = "MD",
                     geometry = TRUE)

pal <- colorQuantile(palette = "YlOrRd", domain = md_income$estimate, n = 10)

pal2 <- colorQuantile(palette = "YlOrRd", domain = md_pop$estimate, n = 10)

pal3 <- colorQuantile(palette = "YlOrRd", domain = md_black_pop$estimate, n = 10)

pal4 <- colorQuantile(palette = "YlOrRd", domain = md_white_pop$estimate, n = 10)

pal5 <- colorQuantile(palette = "BuPu", domain = md_income_tract$estimate, n = 10)

pal6 <- colorQuantile(palette = "BuPu", domain = md_black_pop_tract$estimate, n = 10)

mypalette <- colorNumeric( palette="viridis", md_income$estimate, na.color="transparent")
mypalette_pop <- colorNumeric( palette="viridis", md_pop$estimate)


# Basic choropleth with leaflet?
m <- leaflet(md_shp) %>% 
  addPolygons( fillColor = ~mypalette(estimate), stroke=FALSE, group="Income" )%>%
  addPolygons( fillColor = ~mypalette_pop(estimate), stroke=FALSE, group="Population" )%>%
   addCircleMarkers(
    data=swimming,
    color="blue",
    radius=2,
    group="Swimming")%>%
  addCircleMarkers(
    data=soccer,
    color="black",
    radius=2,
    group="Soccer")%>%
  addLayersControl(
    baseGroups = c("Income", "Population"),
    overlayGroups = c("Swimming", "Soccer"),
    options = layersControlOptions(collapsed = FALSE)
  )

m



```


```{r}


md_shp <- st_read("https://raw.githubusercontent.com/frankrowe/maryland-geojson/master/maryland.geojson")

md_map_all <- leaflet()%>%
  addProviderTiles(providers$CartoDB.Positron)%>%
  addPolylines(
    data=md_shp,
    weight=2,
    color="gray"
  )%>%
  addPolygons(data = md_income, group="Population", color = ~ pal(estimate), stroke = FALSE)%>%
  addPolygons(data = md_pop, group = "Income", color = ~ pal2(estimate), stroke = FALSE)%>%
  addPolygons(data = md_pop, group = "Black Population", color = ~ pal3(estimate), stroke = FALSE)%>%
   addPolygons(data = md_pop, group = "White Population", color = ~ pal4(estimate), stroke = FALSE)%>%
  addPolygons(data = md_income_tract, group = "Income by Tract", color = ~ pal5(estimate), stroke = FALSE)%>%
  addPolygons(data = md_black_pop_tract, group = "Black Population by Tract", color = ~ pal6(estimate), stroke = FALSE)%>%
   addCircleMarkers(
    data=bball,
    color="orange",
    radius=2,
    group="Basketball")%>%
  addCircleMarkers(
    data=golf,
    color="green",
    radius=2,
    group="Golf")%>%
  addCircleMarkers(
    data=skateboarding,
    color="purple",
    radius=2,
    group="Skateboarding")%>%
  addCircleMarkers(
    data=soccer,
    color="black",
    radius=2,
    group="Soccer")%>%
  addCircleMarkers(
    data=swimming,
    color="blue",
    radius=2,
    group="Swimming")%>%
  addLayersControl(
  baseGroups = c("Income", "Income by Tract", "Black Population by Tract", "Population", "Black Population", "White Population"),
  overlayGroups = c("Golf", "Basketball", "Soccer", "Swimming", "Skateboarding"),
  options = layersControlOptions(collapsed = FALSE))
 
 
  
  

md_map_all


```

#exploring race by tract
```{r}

md_black_pop_tract <- get_acs(geography = "tract", 
              variables = "B02001_003", 
              state = "MD", 
              geometry = TRUE)
md_race_pct

md_race_wider <- md_race_pct %>%
  pivot_wider(names_from = "variable", values_from = "estimate")%>%
  distinct(GEOID, black_pop, total_pop)
  mutate(pct_black = black_pop/total_pop)%>%
  mutate(pct_white = white_pop/total_pop)%>%
  mutate(county_clean = str_to_lower(NAME))%>%
  group_by(GEOID)%>%
  summarize(sum)
  

md_pop_clean <-md_race_wider%>%
  separate(county_clean, c("County", "state"), sep = " c", extra = "merge")


```





